# **上位机命令集合**

​

## A类：配置参数，设置好之后基本不需改动

### A0：

+ A0A0:输出SC参数
+ A0A1:输出Read Register参数
+ A0BX:Microroc片数
+ A0C0:High gain shaper 输出
+ A0C1:Low gain shaper 输出
+ A0D0:Disable Selected shaper output OTA
+ A0D1:Enable Selected shaper output OTA

### A1:

+ A1XX:使能XX通道Ctest

### A2:

+ A2XX:选通XX通道Read register

### A3:

+ A3A0:Power pulse unenable
+ A3A1:Power pulse enable

### A4:

+ A4A0:select channel 2 to readout
+ A4A1:select channel 1 to readout

### A5:

+ A5AX:X:Hold Coincid choose

  + 00:out_trigger0
  + 01:out_trigger1
  + 10:out_trigger2
  + 11:External_trigger
+ A5BX:使能hold功能

  + A5B0:不使能hold功能
  + A5B1:使能hold功能
+ A5CX:X*25为从hold开始多长时间ADC开始采数，因为从hold到out_t&h稳定需要一定的时间

### A6

+ A6XY:设置HoldDelay:x:

  + 0Y:HoldDelay的低4位
  + 1Y：HoldDelay的次低4位

+ A6XY:设置HoldTime:x:

  + 4Y:HoldTime[3:0]
  + 5Y:HoldTime[7:4]
  + 6Y:HoldTime[11:8]
  + 7Y:HoldTime[15:12]

+ A7A1:清零Gray Counter

+ A8A0:Enable internal raz_chn and disable external raz_chn

+ A8A1:Disable internal raz_chn and enable external raz_chn

+ A8BX:X --> Internal RAZ mode select

+ A8CX:X --> External RAZ mode select

+ A8DX:X*25ns trigger输出之后，多长时间之后FPGA才开始输出RAZ信号:heavy_multiplication_x:

+ A9A0:External trigger unenable

+ A9A1:External trigger enable

+ ABXX:XX id Chip ID

+ ACA0:SC336=> Select latched

+ ACA1:SC336=>Select direct output

+ ACB0:SC575=>Select Channel Trigger selected by Read Register

+ ACB1:SC575=>Select Channel Trigger selected by NOR64

+ > 新添加命令结束 20170308

+ ADXX:XX->Mask Channel

+ AE0X:Select Mask Discri

  + 0:None
  + 1:Discri0
  + 2:Discri1
  + 3:Discri0,1
  + 4:Discri2
  + 5:Discri0,2
  + 6:Discri1,2
  + 7:Discri0,1,2

+ AE1X:Select mask or unmask

  + 0:All channel unmask
  + 1:Mask selected channel and discriminator
  + 2:Unmask select channel and discriminator

## B类：采集参数，可以调整

+ B00X:Led灯


  + B1XX:XX为Start_Acq_Time的低八位


  + B2YY:YY为Start_Acq_Time的高八位，YYXX*25ns为Start_Acq的时间
  + B3XY: X:sw_hg<1:0>, sw_lg<1:0>

## C类：10-bit DAC和4-bit DAC码值设置

  + CXXX:10-bit DAC Code(这里是需要修改的) C000~CBFF
  + CC00~CFFF:4-bit DAC Code详细说明一下:
  + 从CC0X开始到CCFX，这里一共16个命令为1~16通道的4-bit DAC码值
  + 从CD0X开始到CDFX，16个命令为17~32通道的码值
  + CE0X\~CEFX：33\~48
  + CF0X\~CFFX：49\~64   

  ## D类：开始停止命令

  + D0A2:向芯片载入SC参数
  + D1Bx:选择哪个ASIC上out_T&H输出
  + D2F1:选择监控测试板上的功耗
  + D2F0:选择监控测试板上的out_T&H（默认）

  ## E类：测试控制

  ### E0:

  + E0AX:模式选择
    + E0A0:选择ACQ
    + E0A1:选择S Curve Test
    + E0A2:选择SweepAcq
    + E0A3:选择ADC采集out_t&h
    + E0A4:选择触发方式采数:heavy_multiplication_x:
  + E0B0:选择单通道测试
  + E0B1:选择64通道测试
  + E0C0:单通道测试时从Ctest管脚输入信号
  + E0C1:单通道测试时选择从Input管脚输入信号
  + E0D0:选择触发率测试
  + E0D1:选择计数率测试
  + E0FX:采集开始
    + E0F0:SCurve 测试开始命令
    + E0F1:SCurve测试结束命令
    + E0F2:ADC Start
    + E0F3:ADC Stop

  ### E1:

  + E1XX:XX为单通道测试时的通道号

  ### E2:

  + E2XX:选择最大计数：
    + 00：200
    + 01：1000
    + 02：2000
    + 03：5000
    + 04：10000
    + 05：20000
    + 06：40000
    + 07：50000

  ### E3,E4:

  + E3XX,E4YY:YYXX选择计数率测试时间,时间 = YYXX$\times$1ms

  ### E5:

  + E5XY:
    + E50X, E51Y, E52Z: {Z, Y, X} --> Start DAC
    + E53X, E54Y, E55Z: {Z, Y, X} --> End DAC

  ### E6,E7:

  + E6XX,E7YY: YYXX选择扫域采数最大的数据包个数

  ### E8:

  + E80X:X为ADC start delay time 
  + E81X,E82X:
      + E81X:AdcDataNumber[3:0]
      + E82X:AdcDataNumber[7:4]
+ E83X:x为触发方式采数的End保持时间

### E9

+ ​

## F类：采集命令

  + F0F0:开始
  + F0F1:停止
  + F0F2:复位Microroc AutoAcq和 RAMReadout模块
  + F0FA:清空USB FIFO

